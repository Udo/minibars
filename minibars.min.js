"use strict"
String.prototype.replaceAll=function(t,e){var n=this
return n.split(t).join(e)}
var _m={scope:"data",stack:[],tokenize:function(t){for(var e=[],n=0;n<t.length;n++){var r=t.indexOf("{{",n)
if(-1===r)e.push({type:"text",val:t.slice(n)}),n=t.length
else{var i="{{{"==t.substr(r,3),a="}}"+(i?"}":""),l=t.indexOf(a,r)
if(-1===l)e.push({type:"text",val:t.slice(n)}),n=t.length
else{r>n&&e.push({type:"text",val:t.slice(n,r)})
var s={type:"field",raw:i,val:t.slice(r+a.length,l)},o=s.val.indexOf(" ")
if(-1!==o){s.params=s.val.slice(o+1),s.val=s.val.slice(0,o)
var u=s.params.indexOf("|");-1!==u&&(s.mapTo=s.params.slice(u+1).trim().split(" "),s.params=s.params.slice(0,u))}var c=s.val.substr(0,1)
"#"===c?(s.block="start",s.val=s.val.slice(1)):"/"===c&&(s.block="end",s.val=s.val.slice(1)),e.push(s),n=l+a.length-1}}}return 
e},utils:{vnCounter:0,getName:function(){return"v"+_m.utils.vnCounter++},safe:function(t){return 
null==t&&(t=""),(t+"").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;")},unsafe:function(t){return 
t||""},field:function(t){if(t=(t||"").trim(),'"'==t[0]&&'"'==t[t.length-1])return JSON.stringify(t.slice(1,-1))
if("this"==t)return _m.scope
if("@"==t[0])return t.slice(1)
for(var e=_m.scope,n=0;"."==t[0];)n>0&&_m.stack.length>=n&&(e=_m.stack[_m.stack.length-n]),n++,t=t.slice(1)
var r=t.split("."),i=""
return r.forEach(function(t){"/"==t[0]&&(t=t.slice(1)),i+="["+JSON.stringify(t)+"]"}),e+i},pushScope:function(){return 
_m.stack.push(_m.scope),_m.scope=_m.utils.getName(),_m.scope},popScope:function(){return 
_m.scope=_m.stack.pop()||"data",_m.scope}},gen:{if_start:function(t){return"if("+_m.utils.field(t.params.trim())+") 
{"},if_end:function(t){return"}"},unless_start:function(t){return"if(!"+_m.utils.field(t.params.trim())+") {"},unless_end:function(t){return"}"},each_start:function(t){var 
e=_m.utils.field(t.params.trim()),n=_m.utils.getName(),r=_m.utils.pushScope()
return"if("+e+"&&"+e+".length>0) for(var "+n+"=0;"+n+"<"+e+".length;"+n+"++) {var index="+n+";var "+r+"="+e+"["+n+"];"},each_end:function(t){return 
_m.utils.popScope(),"}"},local_mapping:function(t,e){if(t.mapTo&&t.mapTo.length>0){for(var n="",r=0;r<t.mapTo.length;r++){var i=t.mapTo[r],a=e[r]
i&&a&&(n+="var "+i+" = "+a+";")}return n}return""},properties_start:function(t){var 
e=_m.utils.field(t.params.trim()),n=_m.utils.getName(),r=_m.utils.getName(),i=_m.utils.pushScope()
return"var "+r+"=Object.keys("+e+");if("+e+"&&"+r+".length>0) for(var "+n+"=0; "+n+"<"+r+".length;"+n+"++) {var index="+n+";var key="+r+"["+n+"];var 
"+i+"="+e+"[key];"+_m.gen.local_mapping(t,[i,"key"])},properties_end:function(t){return _m.utils.popScope(),"}"},with_start:function(t){var 
e=_m.utils.field(t.params.trim()),n=_m.utils.pushScope()
return"if("+e+") { var "+n+"="+e+";"+_m.gen.local_mapping(t,[n])},with_end:function(t){return _m.utils.popScope(),"}"},"else":function(t){return"} else 
{"},log:function(t){return"console.log(_m.utils.safe("+_m.utils.field(t.params)+"));"},_text_f:function(t){return"o += 
"+JSON.stringify(_m.opt.trim?t.val.trim():t.val)+";"},_invoke_synth:function(t,e){return"o += 
_m.utils."+(e.raw?"unsafe":"safe")+"("+t+"["+JSON.stringify(e.val)+"]("+_m.utils.field(e.params||"this")+", "+_m.utils.field("this")+", "+JSON.stringify(e.params)+", 
data));"},_field_f:function(t,e){if("start"==t.block||"end"==t.block){var n=t.val+"_"+t.block
return _m.gen[n]?_m.gen[n](t):(console.log("unrecognized field type",n),"")}return _m.gen[t.val]?_m.gen[t.val](t):"function"==typeof 
e[t.val]?_m.gen._invoke_synth("opt",t):"o += _m.utils."+(t.raw?"unsafe":"safe")+"("+_m.utils.field(t.val)+");"}},tokensToCode:function(t,e){var n=[]
return t.forEach(function(t){var r=_m.gen["_"+t.type+"_f"]
"function"!=typeof r?console.log("unrecognized field 
type",t.type):n.push(r(t,e))}),n.join("\n")},compile:function(text,opt){opt||(opt={}),_m.opt=opt,_m.stack=[],_m.scope="data"
var tokens=_m.tokenize((text||"").trim()),code=_m.tokensToCode(tokens,opt)
if(0!=_m.stack.length){var e=function(){return"template error: un-closed blocks"}
return e.error=e(),e}return eval('(function(data) { "use strict"; if(!data) data = {}; var o = ""; '+code+" return(o); })")}},Minibars=_m

