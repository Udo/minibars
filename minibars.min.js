"use strict";var _m={scope:"data",stack:[],tokenize:function(a){for(var b=[],c=0;c<a.length;c++){var d=a.indexOf("{{",c);if(-1===d)b.push({type:"text",val:a.slice(c)}),c=a.length;else{var e="{{{"==a.substr(d,3),f="}}"+(e?"}":""),g=a.indexOf(f,d);if(-1===g)b.push({type:"text",val:a.slice(c)}),c=a.length;else{d>c&&b.push({type:"text",val:a.slice(c,d)});var h={type:"field",raw:e,val:a.slice(d+f.length,g)},i=h.val.indexOf(" ");if(-1!==i){h.params=h.val.slice(i+1),h.val=h.val.slice(0,i);var j=h.params.indexOf("|");-1!==j&&(h.mapTo=h.params.slice(j+1).trim().split(" "),h.params=h.params.slice(0,j))}var k=h.val.substr(0,1);"#"===k?(h.block="start",h.val=h.val.slice(1)):"/"===k&&(h.block="end",h.val=h.val.slice(1)),b.push(h),c=g+f.length-1}}}return b},utils:{vnCounter:0,getName:function(){return"v"+_m.utils.vnCounter++},safe:function(a){return null==a&&(a=""),(a+"").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;")},unsafe:function(a){return a||""},field:function(a){if(a=(a||"").trim(),'"'==a[0]&&'"'==a[a.length-1])return JSON.stringify(a.slice(1,-1));if("this"==a)return _m.scope;if("@"==a[0])return a.slice(1);for(var b=_m.scope,c=0;"."==a[0];)c>0&&_m.stack.length>=c&&(b=_m.stack[_m.stack.length-c]),c++,a=a.slice(1);var d=a.split("."),e="";return d.forEach(function(a){"/"==a[0]&&(a=a.slice(1)),e+="["+JSON.stringify(a)+"]"}),b+e},pushScope:function(){return _m.stack.push(_m.scope),_m.scope=_m.utils.getName(),_m.scope},popScope:function(){return _m.scope=_m.stack.pop()||"data",_m.scope}},gen:{if_start:function(a){return"if("+_m.utils.field(a.params.trim())+") {"},if_end:function(a){return"}"},unless_start:function(a){return"if(!"+_m.utils.field(a.params.trim())+") {"},unless_end:function(a){return"}"},each_start:function(a){var b=_m.utils.field(a.params.trim()),c=_m.utils.getName(),d=_m.utils.pushScope();return"if("+b+"&&"+b+".length>0) for(var "+c+"=0;"+c+"<"+b+".length;"+c+"++) {var index="+c+";var "+d+"="+b+"["+c+"];"},each_end:function(a){return _m.utils.popScope(),"}"},local_mapping:function(a,b){if(a.mapTo&&a.mapTo.length>0){for(var c="",d=0;d<a.mapTo.length;d++){var e=a.mapTo[d],f=b[d];e&&f&&(c+="var "+e+" = "+f+";")}return c}return""},properties_start:function(a){var b=_m.utils.field(a.params.trim()),c=_m.utils.getName(),d=_m.utils.getName(),e=_m.utils.pushScope();return"var "+d+"=Object.keys("+b+");if("+b+"&&"+d+".length>0) for(var "+c+"=0; "+c+"<"+d+".length;"+c+"++) {var index="+c+";var key="+d+"["+c+"];var "+e+"="+b+"[key];"+_m.gen.local_mapping(a,[e,"key"])},properties_end:function(a){return _m.utils.popScope(),"}"},with_start:function(a){var b=_m.utils.field(a.params.trim()),c=_m.utils.pushScope();return"if("+b+") { var "+c+"="+b+";"+_m.gen.local_mapping(a,[c])},with_end:function(a){return _m.utils.popScope(),"}"},"else":function(a){return"} else {"},log:function(a){return"console.log(_m.utils.safe("+_m.utils.field(a.params)+"));"},_text_f:function(a){return"o += "+JSON.stringify(_m.opt.trim?a.val.trim():a.val)+";"},_invoke_synth:function(a,b){return"o += _m.utils."+(b.raw?"unsafe":"safe")+"("+a+"["+JSON.stringify(b.val)+"]("+_m.utils.field(b.params||"this")+", "+_m.utils.field("this")+", "+JSON.stringify(b.params)+", data));"},_field_f:function(a,b){if("start"==a.block||"end"==a.block){var c=a.val+"_"+a.block;return _m.gen[c]?_m.gen[c](a):(console.log("unrecognized field type",c),"")}return _m.gen[a.val]?_m.gen[a.val](a):"function"==typeof b[a.val]?_m.gen._invoke_synth("opt",a):"o += _m.utils."+(a.raw?"unsafe":"safe")+"("+_m.utils.field(a.val)+");"}},tokensToCode:function(a,b){var c=[];return a.forEach(function(a){var d=_m.gen["_"+a.type+"_f"];"function"!=typeof d?console.log("unrecognized field type",a.type):c.push(d(a,b))}),c.join("\n")},compile:function(text,opt){opt||(opt={}),_m.opt=opt,_m.stack=[],_m.scope="data";var tokens=_m.tokenize((text||"").trim()),code=_m.tokensToCode(tokens,opt);if(0!=_m.stack.length){var e=function(){return"template error: un-closed blocks"};return e.error=e(),e}return eval('(function(data) { "use strict"; if(!data) data = {}; var o = ""; '+code+" return(o); })")}},Minibars=_m;