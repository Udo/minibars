Minibars={scope:"data",stack:[],tokenize:function(a){for(var b=[],c=0;c<a.length;c++){var d=a.indexOf("{{",c);if(-1===d)b.push({type:"text",val:a.slice(c)}),c=a.length;else{var e="{{{"==a.substr(d,3),f="}}"+(e?"}":""),g=a.indexOf(f,d);if(-1===g)b.push({type:"text",val:a.slice(c)}),c=a.length;else{d>c&&b.push({type:"text",val:a.slice(c,d)});var h={type:"field",raw:e,val:a.slice(d+f.length,g)},i=h.val.indexOf(" ");if(-1!==i){h.params=h.val.slice(i+1),h.val=h.val.slice(0,i);var j=h.params.indexOf("|");-1!==j&&(h.mapTo=h.params.slice(j+1).trim().split(" "),h.params=h.params.slice(0,j))}var k=h.val.substr(0,1);"#"===k?(h.block="start",h.val=h.val.slice(1)):"/"===k&&(h.block="end",h.val=h.val.slice(1)),b.push(h),c=g+f.length-1}}}return b},utils:{vnCounter:0,getName:function(){return"v"+Minibars.utils.vnCounter++},safe:function(a){return null==a&&(a=""),(a+"").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;")},unsafe:function(a){return a||""},field:function(a){if(a=a.trim(),'"'==a[0]&&'"'==a[a.length-1])return JSON.stringify(a.slice(1,-1));if("this"==a)return Minibars.scope;if("@"==a[0])return a.slice(1);for(var b=Minibars.scope,c=0;"."==a[0];)c>0&&Minibars.stack.length>=c&&(b=Minibars.stack[Minibars.stack.length-c]),c++,a=a.slice(1);var d=a.split("."),e="";return d.forEach(function(a){"/"==a[0]&&(a=a.slice(1)),e+="["+JSON.stringify(a)+"]"}),b+e},pushScope:function(){return Minibars.stack.push(Minibars.scope),Minibars.scope=Minibars.utils.getName(),Minibars.scope},popScope:function(){return Minibars.scope=Minibars.stack.pop()||"data",Minibars.scope}},helpers:{trim:function(a,b,c,d){return a.trim()}},gen:{if_start:function(a){return"if("+Minibars.utils.field(a.params.trim())+") {"},if_end:function(a){return"}"},unless_start:function(a){return"if(!"+Minibars.utils.field(a.params.trim())+") {"},unless_end:function(a){return"}"},each_start:function(a){var b=Minibars.utils.field(a.params.trim()),c=Minibars.utils.getName(),d=Minibars.utils.pushScope();return"if("+b+"&&"+b+".length>0) for(var "+c+"=0;"+c+"<"+b+".length;"+c+"++) {var index="+c+";var "+d+"="+b+"["+c+"];"},each_end:function(a){return Minibars.utils.popScope(),"}"},local_mapping:function(a,b){if(a.mapTo&&a.mapTo.length>0){for(var c="",d=0;d<a.mapTo.length;d++){var e=a.mapTo[d],f=b[d];e&&f&&(c+="var "+e+" = "+f+";")}return c}return""},properties_start:function(a){var b=Minibars.utils.field(a.params.trim()),c=Minibars.utils.getName(),d=Minibars.utils.getName(),e=Minibars.utils.pushScope();return"var "+d+"=Object.keys("+b+");if("+b+"&&"+d+".length>0) for(var "+c+"=0; "+c+"<"+d+".length;"+c+"++) {var index="+c+";var key="+d+"["+c+"];var "+e+"="+b+"[key];"+Minibars.gen.local_mapping(a,[e,"key"])},properties_end:function(a){return Minibars.utils.popScope(),"}"},with_start:function(a){var b=Minibars.utils.field(a.params.trim()),c=Minibars.utils.pushScope();return"if("+b+") { var "+c+"="+b+";"+Minibars.gen.local_mapping(a,[c])},with_end:function(a){return Minibars.utils.popScope(),"}"},"else":function(a){return"} else {"},log:function(a){return"console.log(Minibars.utils.safe("+Minibars.utils.field(a.params)+"));"},_text_f:function(a){return"output += "+JSON.stringify(Minibars.opt.trim?a.val.trim():a.val)+";"},_field_f:function(a){if("start"==a.block||"end"==a.block){var b=a.val+"_"+a.block;return Minibars.gen[b]?Minibars.gen[b](a):(console.log("unrecognized field type",b),"")}return Minibars.gen[a.val]?Minibars.gen[a.val](a):Minibars.helpers[a.val]?"output += Minibars.utils."+(a.raw?"unsafe":"safe")+"(Minibars.helpers["+JSON.stringify(a.val)+"]("+Minibars.utils.field(a.params)+", "+Minibars.utils.field("this")+", "+JSON.stringify(a.params)+", data));":"output += Minibars.utils."+(a.raw?"unsafe":"safe")+"("+Minibars.utils.field(a.val)+");"}},tokensToCode:function(a){var b=[];return a.forEach(function(a){var c=Minibars.gen["_"+a.type+"_f"];"function"!=typeof c?console.log("unrecognized field type",a.type):b.push(c(a))}),b.join("\n")},compile:function(text,opt){opt||(opt={}),Minibars.opt=opt,Minibars.stack=[],Minibars.scope="data";var tokens=Minibars.tokenize(text.trim()),code=Minibars.tokensToCode(tokens);if(0!=Minibars.stack.length){var e=function(){return"template error: un-closed blocks"};return e.error=e(),e}return eval('(function(data) { "use strict"; var output = ""; '+code+" return(output); })")}};